{% load static %}

<div class="card mb-4 shadow-sm">
    <div class="card-body">
        <a href="{% url 'profile' username=post.author.username %}" class="d-flex align-items-center mb-3 text-decoration-none text-dark">
            <img src="{% if post.author.profile.avatar %}{{ post.author.profile.avatar.url }}{% else %}{% static 'img/default_profile.png' %}{% endif %}" class="rounded-circle me-3" width="50" height="50" alt="Avatar">
            <div>
                <h5 class="mb-0">{{ post.author.first_name }} {{ post.author.last_name }}</h5>
                {% if post.author.profile.is_teacher %}
                    <small class="text-muted">@{{ post.author.username }} <span class="badge bg-info text-white fw-normal ms-1">Professor</span></small>
                {% else %}
                    <small class="text-muted">@{{ post.author.username }}</small>
                {% endif %}
                <small class="text-muted d-block mt-1">{{ post.created_at|date:"d M Y, H:i" }}</small>
            </div>
        </a>
        
        <p>{{ post.content }}</p>

        {% if post.image %}
    <div style="height: 350px; overflow: hidden; margin-bottom: 1rem;">
        <img 
            src="{{ post.image.url }}" 
            class="img-fluid rounded post-image" 
            alt="Imagem do Post"
            style="width: 100%; height: 100%; object-fit: cover;"
        >
    </div>
{% endif %}

        <hr>
        
        <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center post-vote-container">
                <a href="{% url 'posts:vote_post' post.id 'like' %}" class="btn btn-link p-0 text-decoration-none text-muted me-2 btn-like-post">
                    <i class="fas fa-thumbs-up"></i>
                    <span class="ms-1 likes-count">{{ post.likes_count }}</span>
                </a>
                <a href="{% url 'posts:vote_post' post.id 'dislike' %}" class="btn btn-link p-0 text-decoration-none text-muted btn-dislike-post">
                    <i class="fas fa-thumbs-down"></i>
                    <span class="ms-1 dislikes-count">{{ post.dislikes_count }}</span>
                </a>
            </div>
            <div>
                <a href="#" class="text-muted">{{ post.comments.count }} comentÃ¡rios</a>
            </div>
        </div>
        
        <hr>
        
        <div class="comments-section mt-4">
            {% for comment in post.comments.all %}
                {% include "posts/comment_card.html" with comment=comment %}
            {% empty %}
                <p class="text-muted">Nenhum comentÃ¡rio ainda.</p>
            {% endfor %}
            
            <form action="{% url 'posts:add_comment_to_post' post.id %}" method="post" enctype="multipart/form-data" class="mt-3">
                {% csrf_token %}
                <div class="d-flex align-items-start">
                    {% if request.user.profile.avatar %}
                        <img src="{{ request.user.profile.avatar.url }}" class="rounded-circle me-3" width="30" height="30" alt="Avatar">
                    {% else %}
                        <img src="{% static 'img/default_profile.png' %}" class="rounded-circle me-3" width="30" height="30" alt="Default Avatar">
                    {% endif %}
                    <div class="flex-grow-1">
                        <div class="mb-3">
                            <textarea class="form-control" name="content" rows="2" placeholder="Escreva um comentÃ¡rio..."></textarea>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center position-relative">
                                <label for="id_image_comment_{{ post.id }}" class="btn btn-link p-0 me-2 text-decoration-none text-muted">
                                    <i class="fas fa-image fa-lg"></i>
                                </label>
                                <input type="file" name="image" id="id_image_comment_{{ post.id }}" accept="image/*" style="display: none;">
                                
                                <button type="button" class="btn btn-link p-0 text-decoration-none text-muted emoji-button">
                                    <i class="fas fa-smile fa-lg"></i>
                                </button>
                                
                                <div class="emoji-picker-dropdown" style="display: none;">
                                    <div class="emoji-grid">
                                        <span class="emoji" data-emoji="ğŸ˜€">ğŸ˜€</span>
                                        <span class="emoji" data-emoji="ğŸ˜‚">ğŸ˜‚</span>
                                        <span class="emoji" data-emoji="ğŸ˜">ğŸ˜</span>
                                        <span class="emoji" data-emoji="ğŸ‘">ğŸ‘</span>
                                        <span class="emoji" data-emoji="â¤ï¸">â¤ï¸</span>
                                        <span class="emoji" data-emoji="ğŸ‰">ğŸ‰</span>
                                        <span class="emoji" data-emoji="ğŸ¤”">ğŸ¤”</span>
                                        <span class="emoji" data-emoji="ğŸ”¥">ğŸ”¥</span>
                                        <span class="emoji" data-emoji="ğŸ’¯">ğŸ’¯</span>
                                        <span class="emoji" data-emoji="ğŸ‘">ğŸ‘</span>
                                        <span class="emoji" data-emoji="ğŸ˜‚">ğŸ˜‚</span>
                                        <span class="emoji" data-emoji="ğŸ¤£">ğŸ¤£</span>
                                        <span class="emoji" data-emoji="ğŸ˜">ğŸ˜</span>
                                        <span class="emoji" data-emoji="ğŸ¥°">ğŸ¥°</span>
                                        <span class="emoji" data-emoji="ğŸ˜œ">ğŸ˜œ</span>
                                        <span class="emoji" data-emoji="ğŸ¤©">ğŸ¤©</span>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-sm btn-outline-primary">Comentar</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>